zapbuy_authentication:
  name: zapbuy_authentication_${self:provider.stage}
  handler: handlers/http/authentication.handler
  memorySize: 512
  timeout: 29
  layers:
    - arn:aws:lambda:${self:provider.region}:${aws:accountId}:layer:marshmallow:2
  package:
    include:
      - handlers/http/authentication.py
      - application/controllers/authentication/*.py
      - application/schemas/authentication/*.py
      - common/*.py
      - models/*.py
  iamRoleStatementsName: zapbuy_authentication_${self:provider.stage}_lambda_role
  iamRoleStatements:
    - Effect: Allow
      Action:
        - dynamodb:PutItem
        - dynamodb:Query
        - dynamodb:UpdateItem
      Resource:
        - !GetAtt ZapBuyTable.Arn
        - !Join ['/', [!GetAtt ZapBuyTable.Arn, '*']]
  events:
    - httpApi:
        method: POST
        path: /auth/sign-up
        cors: true
    - httpApi:
        method: POST
        path: /auth/sign-in
        cors: true
    - httpApi:
        method: POST
        path: /auth/account-confirmation
        cors: true
#    - httpApi:
#        method: POST
#        path: /auth/generate-confirmation-code
#         cors: true
    - httpApi:
        method: POST
        path: /auth/refresh-token
        cors: true
    - httpApi:
        method: POST
        path: /auth/forgot-password
        cors: true
    - httpApi:
        method: POST
        path: /auth/reset-password
        cors: true
    - httpApi:
        method: GET
        path: /auth/profile
        cors: true
        authorizer:
          name: ZapBuyAuthorizer
    - httpApi:
        method: PUT
        path: /auth/profile
        cors: true
        authorizer:
          name: ZapBuyAuthorizer
